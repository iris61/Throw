{"version":3,"sources":["../../../../../../assets/script/modules/play/assets/script/modules/play/RemainedKnifesComponent.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../../../assets/script/modules/play","sourcesContent":["import ResourceUtil from \"../../utils/ResourceUtil\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class RemainedKnifesComponent extends cc.Component {\n\n    private knifeNodePool: cc.NodePool = null;\n    private knifeNodes: cc.Node[] = [];\n\n    private usedKnifeSprite: cc.SpriteFrame;\n    private unusedKnifeSprite: cc.SpriteFrame;\n\n    private knifesCount: number = 0;\n    private thrownKnifesCount: number = 0;\n\n    onLoad() {\n        this.knifeNodePool = new cc.NodePool();\n\n        this.loadRes();\n    }\n\n    public loadRes(): void {\n        ResourceUtil.loadSpriteRes(\"./play/knife_icon_used\", (error: Error, resource: cc.SpriteFrame) => {\n            this.usedKnifeSprite = resource;\n            this.updateRemainedKnifesState();\n        });\n\n        ResourceUtil.loadSpriteRes(\"./play/knife_icon\", (error: Error, resource: cc.SpriteFrame) => {\n            this.unusedKnifeSprite = resource;\n            this.updateRemainedKnifesState();\n        });\n    }\n\n    public addKnifes(count: number): void {\n        this.node.removeAllChildren();\n        for (let i = 0; i < count; i++) {\n            let node = (!this.knifeNodePool || this.knifeNodePool.size() == 0) ? \n                new cc.Node(\"KnifeIcon\" + i) : \n                this.knifeNodePool.get();\n            let spriteComponent: cc.Sprite = node.getComponent(cc.Sprite) ?\n                node.getComponent(cc.Sprite) :\n                node.addComponent(cc.Sprite);\n\n            spriteComponent.spriteFrame = i < this.thrownKnifesCount ? this.usedKnifeSprite : this.unusedKnifeSprite;\n\n            this.knifeNodes.push(node);\n            this.node.addChild(node);\n        }\n        this.knifesCount += count;\n        this.updateRemainedKnifesState();\n    }\n\n    public throwOneKnife(): void {\n        if (this.thrownKnifesCount < this.knifesCount) {\n            this.node.children[this.thrownKnifesCount].getComponent(cc.Sprite).spriteFrame = this.usedKnifeSprite;\n            this.thrownKnifesCount++;\n        }\n    }\n\n    public rollbackOneKnife(): void {\n        this.thrownKnifesCount--;\n        this.node.children[this.thrownKnifesCount].getComponent(cc.Sprite).spriteFrame = this.unusedKnifeSprite;\n    }\n\n    public reset(): void {\n        for (let i = 0; i < this.knifeNodes.length; i++) {\n            this.knifeNodes[i].removeFromParent();\n            this.knifeNodePool.put(this.knifeNodes[i]);\n        }\n        this.knifeNodes = [];\n        this.thrownKnifesCount = 0;\n        this.knifesCount = 0;\n    }\n\n    public updateRemainedKnifesState(): void {\n        for (let i = 0; i < this.knifeNodes.length; i++) {\n            this.knifeNodes[i].getComponent(cc.Sprite).spriteFrame = i < this.thrownKnifesCount ? this.usedKnifeSprite : this.unusedKnifeSprite;\n        }\n    }\n}\n"]}